<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>郵便番号</title>
</head>
<form >
	<p>
		<input id="zipcode" type="text" size="10" />

	<script type="text/javascript">
function searchAddressByZipcloud() {
	// 検索中であることを表示
	document.getElementById('address').value = '検索中...';
	// 郵便番号の取得
	var zipcode = document.getElementById('zipcode').value;
	// zipcloudAPIの呼び出し
	var element = document.createElement('script');
	element.type = 'text/javascript';
	element.charset = 'utf-8';
	element.src = 'http://zipcloud.ibsnet.co.jp/api/search?zipcode='+zipcode+'&callback=writeAddressByZipcloud';
	document.body.appendChild(element);
};
function writeAddressByZipcloud(response) {
	// 検索中の表示を消去
	var element = document.getElementById('address');
	element.value = '';
	// エラー発生時は、アラートを出して終了
	if(response.status != 200) {
		alert(response.message);
		return false;
	}
	// 検索結果がなかった場合も、アラートを出して終了
	if(!response.results) {
		alert('該当する住所が見つかりませんでした');
		return false;
	}
	// 住所文字列の作成
	var address = response.results[0].address1 + response.results[0].address2;
	// 結果が１つの場合は、町域名まで含める
	if(response.results.length == 1) {
		address += response.results[0].address3;
	}
	element.value = address;
};
document.write('<button type="button" class="zipcloud_search" onclick="searchAddressByZipcloud();">郵便番号から住所を検索</button>');
</script>
	
	
	
	</p>
	<p><input type="text" id="address" size="40" /></p>
</form>
<body>
</body>
</html>
